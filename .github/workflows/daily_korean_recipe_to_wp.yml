name: Daily Korean Recipe to WordPress

on:
  workflow_dispatch:
  schedule:
    # 매일 1회 (KST 09:10) -> UTC 00:10
    - cron: '10 0 * * *'

jobs:
  post:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests openai

      - name: Run
        env:
          # WordPress
          WP_BASE_URL: ${{ secrets.WP_BASE_URL }}
          WP_USER: ${{ secrets.WP_USER }}
          WP_APP_PASS: ${{ secrets.WP_APP_PASS }}
          WP_STATUS: publish
          WP_CATEGORY_IDS: '7'

          # MFDS (식품안전나라)
          MFDS_API_KEY: ${{ secrets.MFDS_API_KEY }}
          MFDS_TIMEOUT_SEC: '10'
          MFDS_BUDGET_SEC: '18'

          # 포스팅 옵션
          RUN_SLOT: day
          FORCE_NEW: '0'
          DRY_RUN: '0'
          DEBUG: '0'
          MIN_TOTAL_CHARS: '1200'

          # 이미지
          DEFAULT_THUMB_URL: ''
          UPLOAD_THUMB: '1'
          SET_FEATURED: '1'
          EMBED_IMAGE_IN_BODY: '1'

          # OpenAI 이미지 생성 (이미지 없을 때만 자동 생성)
          USE_OPENAI_IMAGE: '1'
          AUTO_IMAGE: '1'
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          OPENAI_IMAGE_MODEL: 'gpt-image-1.5'
          OPENAI_IMAGE_SIZE: '1024x1024'

          # 태그 자동 생성
          AUTO_TAGS: '1'
          TAG_MAX: '10'

        run: |
          python daily_korean_recipe_to_wp.py
