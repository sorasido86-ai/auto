name: Naver Fashion Daily to WordPress

on:
  workflow_dispatch: {}
  schedule:
    - cron: "13 0 * * *"  # 09:13 KST (UTC 기준)

permissions:
  contents: write

jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"
          cache: "pip"

      - name: Install deps
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Run bot (debug)
        run: |
          python naver_fashion_daily_to_wp.py --debug
        env:
          NAVER_CLIENT_ID: ${{ secrets.NAVER_CLIENT_ID }}
          NAVER_CLIENT_SECRET: ${{ secrets.NAVER_CLIENT_SECRET }}

          # ✅ 너가 등록한 워드프레스 Secrets 이름 그대로
          WP_BASE_URL: ${{ secrets.WP_BASE_URL }}
          WP_USER: ${{ secrets.WP_USER }}
          WP_APP_PASS: ${{ secrets.WP_APP_PASS }}

          SQLITE_PATH: data/naver_fashion_rankings.sqlite3

      - name: Commit DB back to repo (optional)
        run: |
          if [[ -n "$(git status --porcelain data/naver_fashion_rankings.sqlite3)" ]]; then
            git config user.name "github-actions[bot]"
            git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
            git add data/naver_fashion_rankings.sqlite3
            git commit -m "Update rankings db (UTC $(date -u +%F))"
            git push
          else
            echo "No DB changes"
          fi
