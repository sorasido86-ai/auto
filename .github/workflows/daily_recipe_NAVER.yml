name: Daily Recipe (Create Only)

on:
  workflow_dispatch:
  schedule:
    - cron: "0 1,7 * * *"   # KST 10:00, 16:00 (UTC 기준) 필요하면 바꿔요

concurrency:
  group: daily-recipe-create-only
  cancel-in-progress: false

jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install
        run: |
          python -V
          pip install -U pip
          pip install requests openai

      - name: Debug - show target file
        run: |
          pwd
          ls -al
          echo "---- target ----"
          test -f daily_recipe_to_wp_naverstyle.py && echo "FOUND daily_recipe_to_wp_naverstyle.py" || (echo "NOT FOUND" && exit 2)
          python - <<'PY'
          import hashlib, pathlib
          p = pathlib.Path("daily_recipe_to_wp_naverstyle.py")
          print("PATH:", p.resolve())
          print("MD5 :", hashlib.md5(p.read_bytes()).hexdigest())
          print("HEAD:", p.read_text(encoding="utf-8", errors="ignore").splitlines()[0:5])
          PY

      - name: Run bot
        env:
          WP_BASE_URL: ${{ secrets.WP_BASE_URL }}
          WP_USER: ${{ secrets.WP_USER }}
          WP_APP_PASS: ${{ secrets.WP_APP_PASS }}
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          WP_STATUS: "publish"
          WP_CATEGORY_IDS: "7"
          SQLITE_PATH: "data/daily_recipe.sqlite3"
          RUN_SLOT: "day"
          DRY_RUN: "0"
          DEBUG: "1"
          OPENAI_MODEL: "gpt-4.1-mini"
          NAVER_KEYWORDS: ${{ secrets.NAVER_KEYWORDS }}
        run: |
          mkdir -p data
          python daily_recipe_to_wp_naverstyle.py
