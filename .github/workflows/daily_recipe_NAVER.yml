name: Daily Recipe to WordPress (NaverStyle)

on:
  workflow_dispatch:
  schedule:
    # KST 09:10 (UTC 00:10)
    - cron: "10 0 * * *"
    # KST 18:10 (UTC 09:10)
    - cron: "10 9 * * *"

jobs:
  run:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install deps
        run: |
          python -m pip install --upgrade pip
          python -m pip install requests openai

      - name: Debug - list files
        run: |
          pwd
          ls -al
          test -f daily_recipe_to_wp_naverstyle.py || (echo "ERROR: script not found at repo root" && exit 2)

      - name: Run bot (AM slot)
        if: github.event_name == 'schedule' && github.event.schedule == '10 0 * * *'
        env:
          WP_BASE_URL: ${{ secrets.WP_BASE_URL }}
          WP_USER: ${{ secrets.WP_USER }}
          WP_APP_PASS: ${{ secrets.WP_APP_PASS }}
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          WP_STATUS: "publish"
          WP_CATEGORY_IDS: "7"
          SQLITE_PATH: "data/daily_recipe.sqlite3"
          RUN_SLOT: "am"
          DRY_RUN: "0"
          DEBUG: "0"
          NAVER_RANDOM_LEVEL: "2"
          NAVER_EXPERIENCE_LEVEL: "2"
          NAVER_TEXT_TRIES: "3"
          # NAVER_KEYWORDS: "김치찌개,된장찌개,집밥"
          # OPENAI_MODEL: "gpt-4.1-mini"
        run: |
          mkdir -p data
          python daily_recipe_to_wp_naverstyle.py

      - name: Run bot (PM slot)
        if: github.event_name == 'schedule' && github.event.schedule == '10 9 * * *'
        env:
          WP_BASE_URL: ${{ secrets.WP_BASE_URL }}
          WP_USER: ${{ secrets.WP_USER }}
          WP_APP_PASS: ${{ secrets.WP_APP_PASS }}
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          WP_STATUS: "publish"
          WP_CATEGORY_IDS: "7"
          SQLITE_PATH: "data/daily_recipe.sqlite3"
          RUN_SLOT: "pm"
          DRY_RUN: "0"
          DEBUG: "0"
          NAVER_RANDOM_LEVEL: "2"
          NAVER_EXPERIENCE_LEVEL: "2"
          NAVER_TEXT_TRIES: "3"
        run: |
          mkdir -p data
          python daily_recipe_to_wp_naverstyle.py

      - name: Run bot (Manual)
        if: github.event_name == 'workflow_dispatch'
        env:
          WP_BASE_URL: ${{ secrets.WP_BASE_URL }}
          WP_USER: ${{ secrets.WP_USER }}
          WP_APP_PASS: ${{ secrets.WP_APP_PASS }}
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          WP_STATUS: "publish"
          WP_CATEGORY_IDS: "7"
          SQLITE_PATH: "data/daily_recipe.sqlite3"
          RUN_SLOT: "day"
          DRY_RUN: "0"
          DEBUG: "0"
          NAVER_RANDOM_LEVEL: "2"
          NAVER_EXPERIENCE_LEVEL: "2"
          NAVER_TEXT_TRIES: "3"
        run: |
          mkdir -p data
          python daily_recipe_to_wp_naverstyle.py
